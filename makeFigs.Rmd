---
title: "figsFromRonsIPM"
author: "Ben"
date: "March 19, 2015"
output: html_document
---

```{r libraries}
library(ggplot2)
library(dplyr)
library(tidyr)
```

```{r capitlize first letter}

capwords <- function(s, strict = FALSE) {
    cap <- function(s) paste(toupper(substring(s, 1, 1)),
                  {s <- substring(s, 2); if(strict) tolower(s) else s},
                             sep = "", collapse = " " )
    sapply(strsplit(s, split = " "), cap, USE.NAMES = !is.null(names(s)))
}

```


```{r color blind palette}
cbbPalette <- c("#000000", 
                #"#E69F00", "#56B4E9", "#009E73", "#F0E442", 
                "#0072B2", "#D55E00"
                #, "#CC79A7"
                )
```


```{r read data}

fig1 <- read.csv('Copy of Figure 1.csv',header=T)

#make long
f1 <- 
  select(fig1,-X) %>%
  gather(type,value,observed.length:equilibrium.N) %>%
  separate(type, c("type", "var")) %>%
  mutate( type = factor(type,levels=c('observed','predicted','equilibrium'),
                             labels=c('Observed','Predicted','Equilibrium'), ordered=T) ) 

# Fig 4 Left
fig4 <- read.csv('Fig 4 left column.csv',header=T)
f4 <- select(fig4,-X) %>% 
      mutate( effect = ifelse(Type=='Direct','Climate',ifelse(Type=='Indirect','Density','Total')),
              year= iter + 2002 ) 

# Fig 4 Center and Right
fig4CR <- read.csv('Fig 4 cen and right column.csv',header=T)
f4CRa <- select(fig4CR,-X) %>% 
         mutate( year= iter + 2002 ) 
# get totals
f4CRb <- f4CRa %>%         
         group_by( Env,River,iter,year ) %>%
         summarise( dNdt = sum( dNdt )) %>%
         mutate( wrtSeason = 'Total' )

f4CR <- bind_rows(f4CRa,f4CRb) %>%
    mutate( type = factor(wrtSeason,levels=c('Total','Autumn','Winter','Spring','Summer'), ordered=T) ) 

```

```{r make figs}
popSizeWB <- 
  
filter(f1, river=='Westbrook' & var=='N') %>%
ggplot( aes(year,value,shape=type,linetype=type,color=type,size=type) ) +
  geom_point(size=5)+#, shape=16) +
  geom_line() +
  theme_bw(base_size=25) +
  theme(legend.justification=c(0,0), legend.position=c(.7,.83),
        legend.title=element_blank(),
        legend.text = element_text(size = 35)) +
  scale_x_continuous('Year',limits=c(2003,2012), breaks=c(seq(2002,2012,2))) +
  scale_y_continuous('Population size') +
  scale_shape_manual(values=c(16,1,NA)) +
  scale_linetype_manual(values=c(1,3,1)) +
 # scale_colour_manual(values=cbbPalette)+#c("red","blue",'black')) +
  scale_size_manual(values=c(1.,1,1.5)) +
  scale_color_hue(l=40)

ggsave( file=paste0(getwd(),'popSizeWB.png'), plot=popSizeWB, dpi=600 , width=6,height=5, units='in', scale=2 )
 ###################


sensPopSizeWB <- 
  
filter(f4, River=='Westbrook' ) %>%
ggplot( aes( year,dNdt,linetype=effect,color=effect ) ) +
  #geom_point(size=5)+#, shape=16) +
  geom_line(size=1.5) +
  theme_bw(base_size=25) +
  theme(legend.justification=c(0,0), legend.position=c(0.7,0.7),
        legend.title=element_blank(),
        legend.text = element_text(size = 35)) +
  scale_x_continuous('Year',limits=c(2003,2012), breaks=c(seq(2002,2012,2))) +
  scale_y_continuous('Sensitivity of equilibrium population size') +
  scale_linetype_manual(values=c(3,2,1)) +
 # scale_colour_manual(values=cbbPalette)+#c("red","blue",'black')) +
  scale_color_hue(l=40) +
  geom_hline(yintercept=0)

ggsave( file=paste0(getwd(),'sensPopSizeWB.png'), plot=sensPopSizeWB, dpi=600 , width=6,height=5, units='in', scale=2 )
 
###################
# Flow

sensPopSizeF_WB <- 
  
filter(f4CR, River=='Westbrook' & Env == 'Flow' ) %>%
ggplot( aes( year,dNdt,linetype=type,color=type ) ) +
  #geom_point(size=5)+#, shape=16) +
  geom_line(size=1.5) +
  theme_bw(base_size=25) +
  theme(legend.justification=c(0,0), legend.position=c(0.7,0.3),
        legend.title=element_blank(),
        legend.text = element_text(size = 35)) +
  scale_x_continuous('Year',limits=c(2003,2012), breaks=c(seq(2002,2012,2))) +
  scale_y_continuous('Sensitivity of equilibrium population size') +
  scale_linetype_manual(values=c(1,2,3,4,5)) +
 # scale_colour_manual(values=cbbPalette)+#c("red","blue",'black')) +
  scale_color_hue(l=40) +
  geom_hline(yintercept=0)

ggsave( file=paste0(getwd(),'sensPopSizeF_WB.png'), plot=sensPopSizeF_WB, dpi=600 , width=6,height=5, units='in', scale=2 )

###################
# Temperature
sensPopSizeT_WB <- 
  
filter(f4CR, River=='Westbrook' & Env == 'Temp' ) %>%
ggplot( aes( year,dNdt,linetype=type,color=type ) ) +
  #geom_point(size=5)+#, shape=16) +
  geom_line(size=1.5) +
  theme_bw(base_size=25) +
  theme(legend.justification=c(0,0), legend.position=c(0.7,0.4),
        legend.title=element_blank(),
        legend.text = element_text(size = 35)) +
  scale_x_continuous('Year',limits=c(2003,2012), breaks=c(seq(2002,2012,2))) +
  scale_y_continuous('Sensitivity of equilibrium population size') +
  scale_linetype_manual(values=c(1,2,3,4,5)) +
 # scale_colour_manual(values=cbbPalette)+#c("red","blue",'black')) +
  scale_color_hue(l=40) +
  geom_hline(yintercept=0)

ggsave( file=paste0(getwd(),'sensPopSizeT_WB.png'), plot=sensPopSizeT_WB, dpi=600 , width=6,height=5, units='in', scale=2 )

```
